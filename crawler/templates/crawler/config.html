<!DOCTYPE html>
<html>
    <head>
        <style>
		
			.vis-hidden {
				border: 0;
				clip: rect(0 0 0 0);
				height: 1px;
				margin: -1px;
				overflow: hidden;
				padding: 0;
				position: absolute;
				width: 1px;
			}

			label {
			  margin: 10px;
			  padding: 5px;
			}

			input:checked + label {
			  background: repeating-linear-gradient(-45deg, grey, silver 5px, grey 5px, silver 10px);
			  color:white;
			  -webkit-touch-callout: none;
			  -webkit-user-select: none;
			  -khtml-user-select: none;
			  -moz-user-select: none;
			  -ms-user-select: none;
			  user-select: none;
			}
            
            body{
                font-family: sans-serif;
				
		background-color:#1e88e5;           
 }
            .main{
                //border: 2px solid black;
                //border-radius: 30px;
                margin: 10px;
                padding: 20px;
            }
            h2{
                text-align: right;
                margin: 0 50px 0 0;
            }

            .options div{
                display: inline-block;
                border: 1px solid black;
                border-radius: 10px;
                padding: 0.8% 1%;
                margin: 0 0.5% 20px 0.5%;
                font-weight: bold;
                box-shadow: 0px 0px 5px lightgrey;
		cursor:pointer;
            }
			
			button{
				border: 1px solid black;
                border-radius: 10px;
                padding: 0.8% 1%;
                margin: 0 0.5% 20px 0.5%;
                font-weight: bold;
                box-shadow: 0px 0px 5px lightgrey;
			}
			
            .leftSideBar, .rightSideBar{
                display: inline-block;
            }
            .leftSideBar{
				display:none;
                float: left;
                width: 20%;
                text-align: center;
                font-weight: bold;
                margin-left: 0.5%; 
		margin-top:5px;
		margin-right:5px;
		border-radius:10px;
            }
            .leftSideBar div{
                background-color: rgb(223,235,247);
                padding: 10px;
                position: relative;
            }
            .rightSideBar{
		background-color:ghostwhite;
		margin-top:5px;
		margin-bottom:5px;
		border-radius:10px;
            }
            .rightSideBar div{
                display: inline-block;
                text-align: center;
                margin: 5px;
                font-size: 18px;
            }
            .border{
                border: 1px solid black;
                margin: 40px 0;
            }
            @media screen and (max-width: 530px) {
                .rightSideBar{
                    margin-top: 40px;
                    width: 100%;
                }
            }
	    .wrapit{
		border:2px solid;
		border-radius:10px;
		box-shadow:10px 10px 5px #888888;
		background:blueviolet;
		text-align:center;
	    }
	    th,td{
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		border:1px solid black;
		border-radius:5px;
		background:yellowgreen;
		text-align:center;
		cursor:pointer;
	    }
		.duplicate{
		text-align:center;
		padding:10px;
		margin:5px;
		background:#000066;
		font-weight:900;
		color:white;
		cursor:pointer;
		}
		.duplicate:hover{
		background:yellowgreen!important;
		color:honeydew!important;
		}
        </style>
	{% load staticfiles %}
	{% load get %}
    </head>
    <body>
	<div>
<div style="float:left;width:300px;position:fixed;height:100%;background:#000066;">
<form>
<div class="options" align="center">
<div align="center" style="min-width:80%;margin-top:20px;background:#000066;border-radius:10px;border:white;padding:10px;">
<strong align="center" style="color:white;"><b>Choose Themes</b></strong><br><br>
<input type="text" placeholder="Search for a theme !!" style="min-width:50%;" autocomplete="off" list="suggest" id="searchtext" name="query">
<datalist id="suggest">

</datalist>
</div>
</div>
<div style="overflow:scroll;height:100%;position:absolute;">
{% for key,value in categories.items %}
<div class="duplicate" value="{{key|cut:' '}}" id="dup_{{key|cut:' '}}" style="display:block;">{{key}}</div>
{% endfor %}
</div>
</form>
</div>
	<div class="main" style="margin-left:300px;">
            <h2>Configuration</h2>
<div>
<b>&nbspMy prioritized configurations</b>
<div style="overflow:scroll;height:150px;width:100%;margin-right:10px;margin-top:5px;border-radius:10px;box-shadow:10px 10px 5px #888888;background:white;">
<table id="prioritytable" style="margin:5px;width:99%;height:93%;" align="center">
<tr id="noselect" align="center">
<td style="border:0px;background:white;"><b>No Entries Yet</b></td>
</tr>
</table>
</div>
</div>

			<form action="./add_config" method="post" id="mainform">
            <div class="options" align="center" style="margin-top:20px;">
  <div style="background:burlywood;display:none;"><input type="text" id="addtheme" list="suggestMore" autocomplete="off" name="query"> <datalist id="suggestMore">
                                </datalist>

<div style="display:none;">Add Theme</div></div>
                <div id="adder" style="background:burlywood;">Add selection to my prioritized configuration</div>
				<input type="hidden" name="priorities" id="hiddendata"/>
				<button type="submit" value="Submit" onclick="sendpriorities()">Submit</button>
				{% csrf_token %}
            </div>
			{% for key,value in categories.items %}
			<div class="wrapper">
			<div id="cat_{{key|cut:' '}}" value="{{key}}" style="display:none;" class="wrapit">
			<div class="leftSideBar">
                    <div>{{key}}</div>
                </div>
			<div class="rightSideBar">
			{% for j in value %}
                   <div><img src='{{subcategoryimg|get:key|get:j}}' width='100px' height='100px' alt='{{ subcategoryimg.key }}'><br><input id="cat_{{key|cut:' '}}_{{j|cut:' '}}" type="checkbox" name="cat_{{key|cut:' '}}_{{j|cut:' '}}" class="vis-hidden new-post-tags" value="{{key}}__{{j}}" />
                                                <label for="cat_{{key|cut:' '}}_{{j|cut:' '}}">{{j}}</label></div>
			{% endfor %}
			</div>
			</div>
            </div>
			{% endfor %}
            </form>
        </div>
		</div>
<script src="{% static 'crawler/scripts/jquery-1.10.2.js' %}"></script>
<script src="{% static 'crawler/scripts/jquery.nicescroll.js' %}"></script>
<script>
console.log("Autocomplete does not work");
var bar2=document.getElementById("addtheme");
                    $(bar2).on('input',myFunction2());

 function myFunction2() {
                        console.log("The value of the input field was changed.");
                        console.log(bar2.value);
                        var url = "/get_suggestion?query="+bar2.value;

                        var jsonFile = new XMLHttpRequest();
                        jsonFile.open("GET",url,true);
                        jsonFile.send();
			console.log(jsonFile);
                        jsonFile.onreadystatechange = function() {
                            if (jsonFile.readyState== 4 && jsonFile.status == 200) {
                                //console.log(jsonFile.responseText);
                                var resp=JSON.parse(jsonFile.responseText);
                                var options = '';
                                //console.log(resp[1]);
                                //for(var i = 0; i < resp[1].length; i++)
                                //    options += '<option value="'+resp[1][i]+'" />';
                                //document.getElementById('suggestMore').innerHTML = options;
                            }
                         }
                    }
</script>
<script>
function nicescrolling(){
$("#prioritytable").parent().getNiceScroll().resize();
};
$(function() {  
    $("#prioritytable").parent().niceScroll({cursorcolor:"#00F",cursoropacitymin: 0.5,autohidemode: false,cursordragontouch: true,cursorwidth: "10px"});
});
var positions={};
$('#adder').click(function(){
positions={};
$("#prioritytable tr").not("#noselect").remove();
$("#prioritytable").css({'width':'99%','height':'auto'});
var bool=false;
var markup="";
$("#noselect").hide();
$('[id^="cat_"] .rightSideBar').each(function(){
var count=1;
var position={};
$(this).find("input").each(function(){
if($(this).prop('checked')==true){
var temp=$(this).next("label").html()
markup+="<td draggable='true' ondrop='drop_handler(event);' ondragend='dragend_handler(event);' ondragover='dragover_handler(event);' ondragstart='dragstart_handler(event);'>"+temp+"</td>";
position[temp]=count;
count+=1
bool=true;
}
});
if(bool==true){
temp=$(this).parent().attr('value')
markup="<tr><td style='background:burlywood;' align='center'><b>"+temp+"</b></td>"+markup+"</tr>";
$("#prioritytable").append(markup);
positions[temp]=position
console.log(positions);
}
bool=false;
markup="";
nicescrolling();
});
});

var source;
var target;
var sourcename;
function dragstart_handler(ev){
ev.dataTransfer.setData("text/html",ev.target.outerHTML);
source=$(ev.target).parent().find('b').eq(0).html();
sourcename=$(ev.target).html()
}

function dragover_handler(ev){
ev.preventDefault();

}


function drop_handler(ev){
ev.preventDefault();
target=$(ev.target).parent().find('b').eq(0).html();
if(source!=target){

}
else{
var data=ev.dataTransfer.getData('text/html');
var targetname=$(ev.target).html();
$(ev.target).before(data);

if(positions[source][sourcename]>positions[source][targetname]){
temp=positions[source][sourcename];
positions[source][sourcename]=positions[source][targetname];
for(var key in positions[source]){
	if(!positions[source].hasOwnProperty(key)) continue;

		if(positions[source][key]>=positions[source][targetname] && positions[source][key]<=temp){
				positions[source][key]+=1;
		}
}
}
else if(positions[source][sourcename]<positions[source][targetname]){
temp=positions[source][sourcename];
positions[source][sourcename]=positions[source][targetname]-1;
for(var key in positions[source]){
	if(!positions[source].hasOwnProperty(key)) continue;

		if(positions[source][key]<positions[source][targetname] && positions[source][key]>temp){
				if(key!=sourcename){
					positions[source][key]-=1;
					}
		}
}
}
console.log(positions);
}
}

function dragend_handler(ev){
if(source==target){
$(ev.target).remove();
}
}
</script>
<script>
            var bar=document.getElementById("searchtext");
            var cat=[{% for key,value in categories.items %}"{{key}}",{% endfor %}"tobedeleted"]
			var index = cat.indexOf("tobedeleted");
			if (index > -1) {
				cat.splice(index, 1);
			}
		    bar.oninput = function() {myFunction()};
			function myFunction(){
			var options = '';
			for(var i=0;i<cat.length;i++){
			if(bar.value.length>0){
				if(bar.value==cat[i]){
					$("#dup_"+cat[i].replace(/ /g,'')).show();
					$("#dup_"+cat[i].replace(/ /g,'')).trigger('click');
				}
				else if(bar.value.lower==cat[i].slice(0,bar.value.length).lower){
					options += '<option value="'+cat[i]+'" />';
				}
			}
			}
			document.getElementById('suggest').innerHTML = options;
			}
            
                </script>

<script>
/*$(document).ready(function(){
$('[id^=cat_] input').before("<img src='http://www.abc.net.au/news/image/8622742-1x1-700x700.jpg' width='100px' height='100px' alt='none'><br>");
});*/
$(".duplicate").click(function(){
id=$(this).attr('value');
$('.duplicate').css({'background':'#000066','color':'white'});
$('[id^=cat_]').each(function(){
if($(this).find('input:checkbox:checked').length>0){
	var temp=$(this).attr('id').split('_');
	var temp1=temp[1];
	for(var i=2;i<temp.length;i++){
		temp1+="_"+temp[i];
	}
	$('#dup_'+temp1).css({'background':'yellowgreen','color':'honeydew'});
}
});
if($('#cat_'+id).css('display')=='none'){
$('[id^=cat_]').hide();
$('#cat_'+id).show();
if($('#cat_'+id).find('input:checkbox:checked').length>0){
	$(this).css({'background':'yellowgreen','color':'honeydew'});
}
else{
	$(this).css({'background':'#1e88e5','color':'honeydew'});
}
}
else{
$('#cat_'+id).hide();
if($('#cat_'+id).find('input:checkbox:checked').length<1){
	$(this).css({'background':'#000066','color':'white'});
}
}
$('#cat_'+id+' img').click(function(){
$(this).nextAll('label').first().trigger('click');
});
});
function sendpriorities(){
$("#hiddendata").val(JSON.stringify(positions));
$("#mainform").submit();
}
</script>
    </body>
    <html>
